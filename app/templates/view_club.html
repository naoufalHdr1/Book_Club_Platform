{% extends "base.html" %}

{% block style %}
/* Advanced Show More Button Styling */
#show-more-btn {
  display: inline-block;
  color: white;
  background: linear-gradient(135deg, #4a90e2, #8ab6d6); /* Slightly blueish gradient */
  padding: 0.5rem 1.2rem; /* Smaller padding */
  border-radius: 5px; /* Rectangular corners */
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease-in-out;
  position: relative;
  z-index: 1;
  overflow: hidden;
  box-shadow: 0 6px 12px rgba(74, 144, 226, 0.3); /* Softer shadow */
}

#show-more-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #8ab6d6, #4a90e2); /* Inverted blueish gradient */
  z-index: -1;
  transition: transform 0.4s ease;
  transform: scaleX(0);
  transform-origin: left;
}

#show-more-btn:hover::before {
  transform: scaleX(1);
}

#show-more-btn:hover {
  color: #fff;
  box-shadow: 0 12px 20px rgba(74, 144, 226, 0.4);
  transform: translateY(-3px);
}

#show-more-btn:active {
  transform: translateY(0);
  box-shadow: 0 6px 12px rgba(74, 144, 226, 0.3);
}

.edition-card {
  margin-top: 20px;
  box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
}

/* XSmall screens */
@media (max-width: 576px) {
   .card-body-1 {
     overflow: auto;
   }
}

/* Small screens and up */
@media (min-width: 576px) {
}

/* Medium screens and up */
@media (min-width: 768px) {
  /* Fixed Positioning for Book Image and Edition */
  .fixed-section {
    position: sticky;
    top: 20px;
    align-self: flex-start;
    height: 100%;
  }
  .genre-scroll .badge {
    white-space: normal; /* Allow text to wrap */
    text-align: left;
  }
}

/* Large screens and up */
@media (min-width: 992px) {
}

/* XLarge screens and up */
@media (min-width: 1200px) {
}

.genre-scroll {
    overflow: auto; /* Still allows scrolling */
    padding: 5px 10px;
    margin-bottom: 20px;
}

.genre-scroll .badge {
    margin: 5px 0;
    display: inline-block;
    padding: 0.5em 1em;
    font-size: 0.75rem;
    color: #fff;
    border-radius: 20px;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
    transition: background-color 0.4s ease, transform 0.3s ease;
}

.genre-scroll .badge:hover {
    background-color: rgba(47, 93, 150, 0.9);
    transform: translateY(-1.2px) scale(1.02);
    box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.3);
}

/* Hide scrollbar for Google Chrome and Safari */
.genre-scroll::-webkit-scrollbar {
    display: none;
}

/* Hide scrollbar for Firefox */
.genre-scroll {
    scrollbar-width: none;
}

.genre-scroll p{
    background-color: rgb(99 159 221);
}

.hover-shadow {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-shadow:hover {
    transform: translateY(-10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.modal .btn {
  margin: 0 5px;
  border-radius: 0.375rem;
  padding: 0.50rem 1.12rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.label-btn {
  color: #000;
  border-radius: 0.5rem;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.label-btn:hover {
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  transform: scale(1.05); /* Slightly enlarge on hover */
  transition: all 0.3s ease;
}

.label-btn:active {
  background-color: #00BFFF; /* Deep sky blue for active */
  color: #fff;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  transform: scale(0.98); /* Slightly reduce size on active */
}


/* Specifically target the hover-shadow class inside the card */
.hover-shadow:hover {
  transform: translateY(-4px);
}

.btn-check {
  display: none;
}

.modal .btn {
  margin: 0 5px;
  border-radius: 0.375rem;
  padding: 0.50rem 1.12rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.label-btn:hover {
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  transform: scale(1.05);
  transition: all 0.3s ease;
}

.label-btn:active {
  color: #fff;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  transform: scale(0.98);
}

.icon-link {
  color: black;
  text-decoration: none;
  position: relative;
  display: inline-block;
  font-family: Arial, sans-serif; /* Ensure consistent font family */
}

.icon-link::after {
  content: '';
  position: absolute;
  width: 0;
  height: 1.5px;
  background-color: red;
  bottom: 0px;
  left: 50%;
  transform: translateX(-50%);
  transition: width 0.3s ease, background-color 0.3s ease;
}

.icon-link:hover::after {
  width: 100%;
  background-color: red;
}

.icon-link:hover {
  color: red;
}

.icon-link i {
  display: inline-block;
  transition: transform 0.3s ease;
}

.icon-link:hover i {
  transform: translateY(-4px); /* Move the icon up */
}

#modalButton {
  width : 100% !important;
}

.club-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
}

#book-description {
  white-space: pre-wrap; /* Preserves newlines and wraps text */
}

.event-list {
    border-radius: 8px;
    padding: 15px;
}

.event-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 20px;
    transition: box-shadow 0.3s;
}

.event-card:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
}

.event-title {
    margin: 0; /* Remove default margin */
}

.event-description {
    max-height: 50px;
    overflow: hidden;
    white-space: pre-line;
    transition: max-height 0.3s ease;
}

.show-more-btn {
    display: inline-block;
    font-size: 0.9rem;
    color: #007bff;
    cursor: pointer;
    border: none;
    background-color: transparent;
    text-decoration: none;
}

.show-more-btn:hover {
    text-decoration: underline;
}

.event-description-expanded {
    max-height: none; /* Removes height restriction */
}

/* Responsive Pagination */
.pagination {
  display: flex;
  justify-content: center;
  flex-wrap: wrap; /* Ensure wrapping on smaller screens */
  margin-top: 40px;
  gap: 0.5rem;
}

/* Responsive Pagination */
.pagination {
  display: flex;
  justify-content: center;
  flex-wrap: wrap; /* Ensure wrapping on smaller screens */
  margin-top: 20px; /* Reduced margin */
  gap: 0.3rem; /* Reduced gap */
}

.pagination .page-item .page-link {
  color: #5a5a5a;
  font-size: 0.9rem; /* Smaller font size */
  padding: 5px 10px; /* Reduced padding */
  border-radius: 5px; /* Smaller border radius */
  border: 1px solid #ddd;
  transition: all 0.3s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* Lighter shadow */
  background-color: #ffffff;
}

.pagination .page-item .page-link:hover {
  background-color: #e1e1e1;
  border-color: #b0b0b0;
}

.pagination .page-item.active .page-link {
  background-color: #007bff;
  color: white;
  border: 1px solid transparent;
  font-weight: bold;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Lighter shadow */
}

/* General Styles for Carousel */
.carousel {
  position: relative;
  width: 100%;
  margin: 0 auto;
}

.carousel-inner {
  padding: 0 20px;
}

.carousel-item {
  display: flex;
  flex-wrap: nowrap;
  gap: 20px;
}

.carousel-item .card {
  flex: 1 0 20%;
  border: none;
  border-radius: 15px;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Carousel container */
.CarouselGroup {
  display: flex;
  overflow-x: auto; /* Allow horizontal scrolling */
  scroll-snap-type: x mandatory; /* Snap to each item */
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on mobile */
  padding: 10px;
  gap: 20px; /* Space between items */
}

/* Carousel item styling */
.CarouselGroup__item {
  flex: 0 0 auto; /* Prevent items from shrinking */
  width: 250px; /* Adjust as needed */
  scroll-snap-align: center; /* Center items in the viewport */
  list-style: none;
}

/* Ensure the book card is styled consistently */
.book-card {
  display: flex;
  flex-direction: column;
  background-color: #fff;
  border-radius: 8px;
  position: relative;
}

/* Book card cover styling */
.book-card-cover {
  width: 100%;
  height: 350px;
}

.book-card-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.book-card:hover .book-card-cover img {
  transform: scale(1.02);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
}

.book-card:hover .book-title {
  text-decoration: underline;
  transition: width 0.7s ease;
}

/* Book card content styling */
.book-card-content {
  padding-top: 15px;
  background-color: #f9f9f9; /* Light background for content area */
}

a {
  text-decoration: none;
}

/* Title styling */
.book-title {
  font-size: 1.25rem; /* Slightly larger for emphasis */
  font-weight: 600; /* Semi-bold */
  color: #222; /* Darker color for better readability */
  margin-bottom: 4px;
  line-height: 1.3; /* Improved line spacing */
}

/* Author styling */
.book-author {
  font-size: 1rem;
  color: #555; /* Slightly lighter than title */
  margin-bottom: 7px;
  line-height: 1.2; /* Improved line spacing */
}

/* Rating styling */
.book-rating {
  display: flex;
  align-items: center;
  font-size: 0.9rem;
  color: #333; /* Darker text color */
}

.rating-stars {
  display: flex;
  align-items: center;
  margin-right: 10px; /* Space between stars and rating value */
}

.rating-value {
  font-weight: 600; /* Semi-bold for emphasis */
  color: #f39c12; /* Gold color for rating value */
  margin-right: 5px; /* Space between rating value and count */
}

.rating-count {
  color: #777; /* Lighter color for count */
}

.hover-shadow {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card-img-top {
    border-top-left-radius: calc(0.375rem - 1px);
    border-top-right-radius: calc(0.375rem - 1px);
    width: 233px;
    height: 350px;
}

.card-img-top {
    transition: transform 0.5s ease;
}

.card:hover .card-img-top {
    transform: scale(1.03);
}

/* General container styling */
.container {
  max-width: 1200px;
  margin: auto;
}

.btn-check {
  display: none; /* Hide the default checkbox */
}

/* Specifically target the hover-shadow class inside the card */
.hover-shadow:hover {
  transform: translateY(-4px);
}

{% endblock %}

{% block content %}

<div class="alert alert-info">
    <div class="d-none d-xl-block font-weight-bold">X-LARGE (XL)</div>
    <div class="d-none d-lg-block d-xl-none font-weight-bold">LARGE (LG)</div>
    <div class="d-none d-md-block d-lg-none font-weight-bold">MEDIUM (M)</div>
    <div class="d-none d-sm-block d-md-none font-weight-bold">SMALL (SM)</div>
    <div class="d-block d-sm-none alert font-weight-bold">X-SMALL (Default)</div>
</div>


<div class="container my-5">
  <div class="row gx-md-3 gx-lg-4">
    <!-- Book Image Section -->
    <div class="test col-12 col-md-4 mb-4 d-flex justify-content-center d-md-block fixed-section">
      <!-- Book image -->
      <div class="d-block">
        <div class="card shadow-lg mb-4">
          <img class="club-image" src="{{ club.club_img }}" alt="{{ club.name }}" class="card-img-top book-image">
        </div>

      <!-- Modal Button -->
      <div class="mb-3">
        <div class="d-flex justify-content-center">
	  {% if not membership %}
            <form action="{{ url_for('main.join_club', club_id=club.id) }}" method="POST">
              <button id="modalButton" type="submit" class="btn btn-outline-success btn-lg shadow-lg px-5"><i class="bi bi-person-plus"></i> Join Club</button>
            </form>
          {% else %}
            <form action="{{ url_for('main.leave_club', club_id=club.id) }}" method="POST">
              <button id="modalButton" type="submit" class="btn btn-lg btn-outline-danger shadow-lg px-5"><i class="bi bi-trash"></i> Leave Club</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>

      <!-- Edition -->
      <div class="card d-none d-md-block border border-0">
        <div class="card-body shadow-lg p-4">
          <h2 class="text-muted fs-3 mb-3">Club Info:</h2>
	  <hr>
          <p class="text-muted fs-6"><strong>Category: </strong>
            {{ club.category }}
          </p>
          <p class="text-muted fs-6"><strong>Creation Date: </strong>
            {{ club.created_at.strftime('%b %d, %Y') }}
          </p>
          <p class="text-muted fs-6"><strong>Created by: </strong>
            {{ club.creator.username }}
          </p>
        </div>
      </div>
    </div>

    <!-- Book Details Section -->
    <div class="col-md-8 mb-3">
      <div class="row">
        <div class="col-12 mb-5">
          <div class="card-1 shadow-lg border-0 d-flex align-items-center">
            <div class="card-body-1 p-4 p-lg-5">
              <h1 class="display-4 fw-bold text-primary mb-4">{{ club.name }}</h1>
	      <hr>
	      <p class="text-muted fs-3">
	        <i class="bi bi-person"></i> By <a href="{{ url_for('main.view_profile', username=club.creator.username) }}">{{ club.creator.username }}</a>
              </p>
    	      <div class="d-block d-md-none">
                <p class="text-muted fs-6"><strong>Category: </strong>
  	          {{ club.category }}
          	</p>
          	<p class="text-muted fs-6"><strong>Creation Date: </strong>
            	  {{ club.created_at.strftime('%b %d, %Y') }}
          	</p>
          	<p class="text-muted fs-6"><strong>Created by: </strong>
            	  {{ club.creator.username }}
          	</p>
	      </div>
              <p class="text-muted fs-6"><strong>Genre: </strong>
     	      <div class="genre-scroll">
	        <p class="badge">{{ club.category }}</p>
	      </div>
              <!-- Description with Show More -->
	      <p class="lead" id="book-description"></p>
	      {% if club.description|length > 300 %}
	        <button class="btn" id="show-more-btn" onclick="toggleDescription()">Show More</button>
	      {% endif %}
            </div>
          </div>
        </div>

        <!-- Members Section -->
        <div class="col-12 mb-3">
	  <h2 class="text-muted fs-3 px-4">Members ({{ members|length }})</h2><hr>
          <div class="row px-4">
            {% for member in members[:6] %}
              <div class="col-4 col-lg-2 mb-3">
                <div class="card border-0">
	          <a href="{{ url_for('main.view_profile', username=member.user.username) }}" class="position-relative">
                    <img src="{{ member.user.profile_picture }}" class="card-img-top" alt="{{ member.username }}" style="height: 110px; min-height: 110px;width: 75px; object-fit: cover; position: relative;">
                    {% if member.role == 'admin' %}
                      <span class="badge bg-info text-light position-absolute bottom-0 start-0" style="border-radius: 0px 10px 10px 0px;">Admin</span>
                    {% elif member.role == 'moderator' %}
                      <span class="badge bg-warning text-dark position-absolute bottom-0 start-0" style="border-radius: 0px 10px 10px 0px;">Moderator</span>
	            {% endif %}
	          </a>
                  <div class="card-body text-left px-0 py-2">
	            <h5 class="card-title" style="font-size: 1rem;text-transform: capitalize;">
	              <a href="{{ url_for('main.view_profile', username=member.user.username) }}">{{ member.user.username }}</a>
		    </h5>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          <!-- "More members..." link -->
          <div class="text-end mb-4">
            <button class="btn btn-sm" id="show-more-btn">
              <a href="{{ url_for('main.view_members', club_id=club.id) }}" style="text-decoration:none; color:white;">More Members...
	      </a>
            </button>
          </div>
        </div>

        <!-- Upcoming Events Section -->
  	<div id="events" class="col-12">
	  <h2 class="text-muted fs-3 px-4">Upcoming Events ({{ total_events }})</h2><hr>
  	  <div class="event-list px-4">
    	    {% for event in events %}
      	      <div class="event-card mb-3">
        	<div class="d-lg-flex justify-content-between align-items-center">
          	  <h3 class="event-title fs-3 text-primary mb-2 mb-lg-3">{{ event.name }}</h3>
                  <div class="genre-scroll px-0">
                    <p class="badge">{{ event.start_time.strftime('%b %d, %Y') }} - {{ event.end_time.strftime('%b %d, %Y') }}</p>
                  </div>
                </div>

                <!-- Event Status -->
                <div class="event-status mb-2">
                  {% if event.start_time > now %}
            	    <span class="badge bg-primary">Upcoming</span>
          	  {% elif event.start_time <= now <= event.end_time %}
            	    <span class="badge bg-success">Ongoing</span>
          	  {% else %}
            	    <span class="badge bg-danger">Expired</span>
          	  {% endif %}
                </div>

                <!-- Event Description with Show More functionality -->
                <div class="event-description-container px-1 mb-4 mb-lg-1">
           	  <p class="event-description text-truncate">{{ event.description }}</p>
          	  {% if event.description|length > 100 %}
            	    <button class="btn btn-link show-more-btn text-primary p-0" onclick="toggleDescription(this)">Show More</button>
          	  {% endif %}
        	</div>

        	<div class="text-end">
          	  <!-- View Event Button -->
          	  <a href="" class="btn btn-outline-secondary btn-sm"><i class="bi bi-eye"></i> View Event</a>

          	  <!-- Join/Leave Event Buttons -->
		  {% if membership %}
         	    {% if current_user in event.participants %}
            	      <form action="{{ url_for('main.leave_event', event_id=event.id) }}" method="POST" class="d-inline">
             	        <button type="submit" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i> Leave Event</button>
            	      </form>
          	    {% else %}
           	      <form action="{{ url_for('main.join_event', event_id=event.id) }}" method="POST" class="d-inline">
              	        <button type="submit" class="btn btn-outline-primary btn-sm"><i class="bi bi-plus-circle"></i> Join Event</button>
            	      </form>
          	    {% endif %}
          	  {% endif %}
        	</div>
      	      </div>
    	    {% endfor %}
  	  </div>
  	  {% if events|length == 0 %}
    	    <p class="text-muted">No upcoming events at the moment.</p>
  	  {% endif %}
	</div>

	<!-- Pagination Controls For Events Section -->
        <nav aria-label="Page navigation" style="margin-bottom:25px;">
  	  <ul class="pagination justify-content-center">
    	    {% if events_pagination.has_prev %}
      	      <li class="page-item">
		<a class="page-link" href="{{ url_for('main.view_club', club_id=club.id, events_page=events_pagination.prev_num) }}#events" aria-label="Previous">
          	  <span aria-hidden="true">&laquo;</span>
        	</a>
      	      </li>
    	    {% endif %}
            {% for page_num in range(1, events_pagination.pages + 1) %}
      	      <li class="page-item {% if page_num == events_pagination.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('main.view_club', club_id=club.id, events_page=page_num) }}#events">{{ page_num }}</a>
              </li>
    	    {% endfor %}
            {% if events_pagination.has_next %}
      	      <li class="page-item">
                <a class="page-link" href="{{ url_for('main.view_club', club_id=club.id, events_page=events_pagination.next_num) }}#events" aria-label="Next">
          	  <span aria-hidden="true">&raquo;</span>
        	</a>
      	      </li>
    	    {% endif %}
  	  </ul>
        </nav>

        <!-- Create Event Link -->
	{% if membership %}
          <div class="text-end mb-4">
            <button class="btn btn-sm" id="show-more-btn">
	      <a href="{{ url_for('main.create_event', club_id=club.id) }}" style="text-decoration:none; color:white;"><i class="bi bi-plus-circle"></i> Create Event
              </a>
            </button>
          </div>
	{% endif %}

	<!-- Current Books Section -->
        <div class="col-12">
	  <h2 class="text-muted fs-3 px-4">Current Books</h2><hr>
          {% if current_books %}
	    <!-- Carousel Wrapper -->
            <div id="booksCarousel" class="carousel slide" data-bs-ride="carousel">
              <!-- Carousel inner -->
              <ul class="CarouselGroup" data-testid="items">
                {% for book in current_books %}
                  <li class="CarouselGroup__item genre-scroll">
                    <div class="book-card">
                      <a class="BookCard__clickCardTarget BookCard__interactive BookCard__block" href="{{ url_for('club_bp.view_book', book_id=book['id']) }}" tabindex="0">
                        <div class="book-card-cover">
		          <img src="{{ book.cover_image}}" alt="{{ book.title }}">
                        </div>
                        <div class="book-card-content bg-white shadow-md">
                          <div class="book-title">
		            {{ book.title }}
		    	  </div>
                          <div class="book-author">
			    <p class="text-muted medium mb-0" style="background-color: white;"><i class="bi bi-person"></i>
                              {{ book.author }}
              		    </p>
		   	  </div>
                          <div class="book-rating">
                            <div class="rating-stars">
			      <i class="bi bi-star-fill text-warning fs-3"></i>
                            </div>
                            <div class="rating-value">
			      {{ book.get('rating', '4.3') }}
			    </div>
                            <div class="rating-count">
			      {{ book.get('count', '26.4K') }}
			    </div>
              		  </div>
                        </div>
                      </a>
                    </div>
                  </li>
                {% endfor %}
              </ul>
            </div>
	  {% else %}
            <p class="text-muted px-5">No Related Books Found!</p>
          {% endif %}
	</div>

      </div>
    </div>
  </div>
</div>

<script>

  const fullDescription = {{ club.description|tojson }};
  const shortDescription = fullDescription.slice(0, 300) + (fullDescription.length > 300 ? "..." : "");

  function toggleDescription() {
    const desc = document.getElementById('book-description');
    const btn = document.getElementById('show-more-btn');
    if (btn.textContent === 'Show More') {
      desc.textContent = fullDescription;
      btn.textContent = 'Show Less';
    } else {
      desc.textContent = shortDescription;
      btn.textContent = 'Show More';
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const desc = document.getElementById('book-description');
    desc.textContent = shortDescription; // Ensure the short description is set initially
  });
      document.addEventListener('DOMContentLoaded', function () {
        const stars = document.querySelectorAll('.star-rating label');

        stars.forEach(star => {
            star.addEventListener('mouseover', function () {
                const ratingValue = this.htmlFor.replace('rating', '');
                highlightStars(ratingValue);
            });

            star.addEventListener('click', function () {
                const ratingInput = document.getElementById(this.htmlFor);
                ratingInput.checked = true;
            });
        });

        function highlightStars(ratingValue) {
            stars.forEach(star => {
                if (star.htmlFor.replace('rating', '') <= ratingValue) {
                    star.classList.replace('bi-star', 'bi-star-fill');
                } else {
                    star.classList.replace('bi-star-fill', 'bi-star');
                }
            });
        }
    });

  function toggleDescription(button) {
    var description = button.previousElementSibling; // Get the previous sibling (the description)

    // Toggle between expanded and truncated
    if (description.classList.contains('event-description-expanded')) {
        description.classList.remove('event-description-expanded');
        button.textContent = "Show More";
    } else {
        description.classList.add('event-description-expanded');
        button.textContent = "Show Less";
    }
}


</script>
{% endblock %}
